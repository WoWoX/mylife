<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>AVChatManager</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" type="text/css" href="../css/VisDoc.css" /><script src="../js/jquery.js" type="text/javascript">//</script><script src="../js/common.js" type="text/javascript">//</script><script src="../js/doc.js" type="text/javascript">//</script></head><body id="page_com_smartfoxserver_redbox_AVChatManager"><script type="text/javascript">VisDoc.initBody();</script><div id="PageTop"><!----></div><div class="VisDoc"><div class="content"><div class="docNav"><ul><li><div id="twistyTOC_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited activeWhenNotFramed"><a href="#"><span class="icon">+</span>Show TOC</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyTOC_show");</script><div id="twistyTOC_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited activeWhenFramed"><a href="#"><span class="icon">&times;</span>Hide TOC</a></div><span id="twistyTOC_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyTOC_hide");</script></li></ul><ul class="accessKeyLinks"><li><a href="#PageTop" accesskey="t"><span class="accessKey">T</span>op</a></li><li><a href="#Summary" accesskey="s"><span class="accessKey">S</span>ummary</a></li><li><a href="#Constructor" accesskey="c"><span class="accessKey">C</span>onstructors</a></li><li><a href="#Classproperties" accesskey="l">C<span class="accessKey">l</span>ass properties</a></li><li><a href="#Instanceproperties" accesskey="l">Instance <span class="accessKey">p</span>roperties</a></li><li><a href="#Instancemethods" accesskey="m">Instance <span class="accessKey">m</span>ethods</a></li><li><a href="#Eventhandlers" accesskey="e"><span class="accessKey">E</span>vent handlers</a></li></ul><br class="clear" /></div><h1>AVChatManager</h1><div class="classProperties"><table cellspacing="0"><tr><th align="left">Kind of class:</th><td>class</td></tr><tr><th align="left">Inherits from:</th><td>none</td></tr><tr><th class="classDetails" align="left">Version:</th><td class="classDetails">1.0.0</td></tr><tr><th class="classDetails" align="left">Author:</th><td class="classDetails">The gotoAndPlay() Team<br />			<a href="http://www.smartfoxserver.com">http://www.smartfoxserver.com</a><br />			<a href="http://www.gotoandplay.it">http://www.gotoandplay.it</a></td></tr><tr><th class="classDetails" align="left">Classpath:</th><td class="classDetails">com.smartfoxserver.redbox.AVChatManager</td></tr><tr><th class="classDetails" align="left">File last modified:</th><td class="classDetails">Tuesday, 08 July 2008, 08:07:04</td></tr></table></div><div class="classDescription"><span class="descriptionSummary">SmartFoxServer's RedBox Audio/Video Chat Manager.</span><br />This class is responsible for audio/video chat implementation by means of the connection to the Red5 server.<br />The AVChatManager handles the chat workflow (send request, accept or refuse it, establish or stop connection, etc.) and the live streaming to/from the Red5 server.<br /><br /><b>NOTE</b>: in the provided examples, <code>avChatMan</code> always indicates an AVChatManager instance.<div class="classFields"><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Usage:</span><div class="item"><ul><li> The <b>AVChatManager</b> class is useful to create one-on-one audio/video chats. Three chat modes are supported: receive-only, send-only or send-and-receive.<br />			In send-only and receive-only modes, the a/v chat requests are distinct: a user can watch a friend without sending his own stream, and vice versa (just like in Windows Live Messenger, when you click the webcam icons under the users' pictures).<br />			In send-and-receive mode, a single request includes both sending the user's own stream and receiving the friend's stream.<br />			The following workflow is suggested (to make it simpler the send-and-receive mode is considered; for the other modes the flow is the same, but two separate requests are needed).<ol><li>The current user click on an interface element to send the a/v chat request to a friend; usually a button in a private chat window is used.</li><li>An invitation is sent to the recipient user by means of the <a href="com_smartfoxserver_redbox_AVChatManager.html#sendChatRequest">sendChatRequest</a> method; of course the recipient must be connected to SmartFoxServer (but not necessarily in the same room of the requester), otherwise the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onRecipientMissing">com.smartfoxserver.redbox.events.RedBoxChatEvent.onRecipientMissing</a> event is fired on the requester's client.</li><li>On the recipient's client the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRequest">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRequest</a> event is fired: an invitation to send and receive the a/v stream is displayed, together with the interface elements to accept or decline it.<br />				If the recipient refuses the invitation, the <a href="com_smartfoxserver_redbox_AVChatManager.html#refuseChatRequest">refuseChatRequest</a> method is called, which causes the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRefused">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRefused</a> event to be fired on the requester's client and the interface to be adjusted accordingly.</li><li>The recipient accepts the invitation: the <a href="com_smartfoxserver_redbox_AVChatManager.html#acceptChatRequest">acceptChatRequest</a> method is called, which causes the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStarted">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStarted</a> event to be fired on both the requester's and the recipient's clients.</li><li>On both the requester's and the recipient's clients two Video objects are added to the stage to display the incoming stream and the user's own camera output.</li><li>One of the two users involved in the chat clicks on an interface element to stop the a/v chat: the <a href="com_smartfoxserver_redbox_AVChatManager.html#stopChat">stopChat</a> method is called and the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStopped">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStopped</a> event is fired on the connected user's client, so that the Video objects can be removed from stage.</li></ol> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionInited">RedBoxChatEvent</a> with type: <code>onAVConnectionInited</code> <ul class="summary inheritDoc"><li>	Dispatched when the connection to Red5 server has been established.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionError">RedBoxChatEvent</a> with type: <code>onAVConnectionError</code> <ul class="summary inheritDoc"><li>Dispatched when the connection to Red5 server can't be established.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRequest">RedBoxChatEvent</a> with type: <code>onChatRequest</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat request is received.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onRecipientMissing">RedBoxChatEvent</a> with type: <code>onRecipientMissing</code> <ul class="summary inheritDoc"><li>Dispatched when a chat request is sent, but the recipient is not available.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onDuplicateRequest">RedBoxChatEvent</a> with type: <code>onDuplicateRequest</code> <ul class="summary inheritDoc"><li>Dispatched when a chat request is sent, but a mutual request has already been sent by the recipient.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRefused">RedBoxChatEvent</a> with type: <code>onChatRefused</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat request has been refused by the recipient.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStarted">RedBoxChatEvent</a> with type: <code>onChatStarted</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat session is started, after the recipient accepted the requester's invitation.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStopped">RedBoxChatEvent</a> with type: <code>onChatStopped</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat session is stopped.</li></ul></li></ul></div></div></div></div></div></div><div class="summary"><h2 id="Summary">Summary</h2><div class="docNav"><ul><li><div id="twistyTypeInfo_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">&times;</span>Hide type info</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleTypeInfo_on");</script><div id="twistyTypeInfo_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">+</span>Show type info</a></div><span id="twistyTypeInfo_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleTypeInfo_off");</script></li><li><div id="twistySummaries_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">&times;</span>Hide summaries</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSummaries_on");</script><div id="twistySummaries_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">+</span>Show summaries</a></div><span id="twistySummaries_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSummaries_off");</script></li><li><div id="twistySort_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">&times;</span>Sort by source order</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSort_on");</script><div id="twistySort_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">+</span>Sort alphabetically</a></div><span id="twistySort_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSort_off");</script></li></ul><br class="clear" /></div><div class="memberList"><div class="memberSummaryPart"><span class="title">Constructor</span><ul class="sortable" id="sortul1"><li class="sortli listnum1"><a href="#AVChatManager">AVChatManager</a><span class="typeInfo"> (red5Ip:String, debug:Boolean)</span><ul class="summary"><li>	AVChatManager contructor.</li></ul></li></ul></div><div class="memberSummaryPart"><span class="title">Class properties</span><ul class="sortable" id="sortul2"><li class="sortli listnum1"><a href="#REQ_TYPE_SEND">REQ_TYPE_SEND</a><span class="typeInfo">  : String</span><ul class="summary"><li>	Audio/video chat request type: "stream from requester to recipient".</li></ul></li><li class="sortli listnum2"><a href="#REQ_TYPE_RECEIVE">REQ_TYPE_RECEIVE</a><span class="typeInfo">  : String</span><ul class="summary"><li>Audio/video chat request type: "stream from recipient to requester".</li></ul></li><li class="sortli listnum3"><a href="#REQ_TYPE_SEND_RECEIVE">REQ_TYPE_SEND_RECEIVE</a><span class="typeInfo">  : String</span><ul class="summary"><li>Audio/video chat request type: "bi-directional stream".</li></ul></li></ul></div><div class="memberSummaryPart"><span class="title">Instance properties</span><ul class="sortable" id="sortul3"><li class="sortli listnum1"><a href="#isConnected">isConnected</a><span class="typeInfo">  : Boolean</span><ul class="summary"><li>The status of the connection to the Red5 server.</li></ul></li></ul></div><div class="memberSummaryPart"><span class="title">Instance methods</span><ul class="sortable" id="sortul4"><li class="sortli listnum1"><a href="#initAVConnection">initAVConnection</a><span class="typeInfo">  : Void</span><ul class="summary"><li>	Initialize the audio/video connection.</li></ul></li><li class="sortli listnum2"><a href="#destroy">destroy</a><span class="typeInfo">  : Void</span><ul class="summary"><li>	Destroy the AVChatManager instance.</li></ul></li><li class="sortli listnum3"><a href="#getChatSession">getChatSession</a><span class="typeInfo"> (sessionId:String) : <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">ChatSession</a></span><ul class="summary"><li>	Retrieve a com.smartfoxserver.redbox.data.ChatSession object instance.</li></ul></li><li class="sortli listnum4"><a href="#sendChatRequest">sendChatRequest</a><span class="typeInfo"> (type:String, recipientId:Number, enableCamera:Boolean, enableMicrophone:Boolean) : <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">ChatSession</a></span><ul class="summary"><li>	Send a request to start an audio/video chat.</li></ul></li><li class="sortli listnum5"><a href="#refuseChatRequest">refuseChatRequest</a><span class="typeInfo"> (sessionId:String) : Void</span><ul class="summary"><li>	Refuse an incoming request to start an audio/video chat.</li></ul></li><li class="sortli listnum6"><a href="#acceptChatRequest">acceptChatRequest</a><span class="typeInfo"> (sessionId:String) : Void</span><ul class="summary"><li>	Accept an incoming request to start an audio/video chat.</li></ul></li><li class="sortli listnum7"><a href="#stopChat">stopChat</a><span class="typeInfo"> (sessionId:String) : Void</span><ul class="summary"><li>	Stop an a/v chat session currently in progress.</li></ul></li><li class="sortli listnum8"><a href="#addEventListener">addEventListener</a><span class="typeInfo"> (type:String, listener:Function) : Void</span><ul class="summary"><li>	Register a listener function in order to receive notification of a RedBox event.</li></ul></li><li class="sortli listnum9"><a href="#removeEventListener">removeEventListener</a><span class="typeInfo"> (type:String, listener:Function) : Void</span><ul class="summary"><li>	Remove a listener from the event dispatcher, to stop receiving notification of an event.</li></ul></li></ul></div></div></div><div class="memberSection"><h2 id="Constructor">Constructor</h2><div class="member" id="AVChatManager"><h3>AVChatManager</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>AVChatManager</b> (

</div><div class="code">red5Ip:String,
debug:Boolean)</div><br class="clear" /></div></div><div class="description"> 	AVChatManager contructor.<br />The RedBox classes make an extensive use of the SmartFoxBits Connector's s event handler in order to communicate with SmartFoxServer.<br />To achieve this you should place the Connector on a frame before you use RedBox classes on the following frame(s) or to make sure that the Connector is on the lowest layer of the timeline, and set the "Load order" option in the Flash Publish Settings to "Bottom up". </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">red5Ip<span class="itemSeparator">:</span></div><div>the Red5 server IP address.</div></div><div class="item"><div class="floatbox code colorizedCode">debug <span class="itemSeparator">:</span></div><div>turn on the debug messages (optional, default is <code>false</code>).</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Throws:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_ConnectorNotFoundException.html">com.smartfoxserver.redbox.exceptions.ConnectorNotFoundException</a> if the SmartFoxBits Connector is not placed on the Stage. </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_MyUserPropsNotSetException.html">com.smartfoxserver.redbox.exceptions.MyUserPropsNotSetException</a> if the <i>SmartFoxClient.myUserId</i> or <i>SmartFoxClient.myUserName</i> properties are not set. </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidParamsException.html">com.smartfoxserver.redbox.exceptions.InvalidParamsException</a> if the <code>red5Ip</code> is not well formated IP address. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to instantiate the AVChatManager class.<br />			<pre>
<span class="codeKeyword">var</span> red5IpAddress:<span class="codeIdentifier">String</span> = <span class="codeString">"127.0.0.1"</span>

<span class="codeKeyword">var</span> avChatMan:AVChatManager = <span class="codeKeyword">new</span> AVChatManager(red5IpAddress)</pre><br />see		MyUserPropsNotSetException </li></ul></div></div></div></div></div></div><div class="memberSection"><h2 id="Classproperties">Class properties</h2><div class="member" id="REQ_TYPE_RECEIVE"><h3>REQ_TYPE_RECEIVE</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">static</span> <b>REQ_TYPE_RECEIVE</b>:String = <span class="codeString">"receive"</span>
</div><div class="floatbox"><span class="access">(read)</span></div><br class="clear" /></div></div><div class="description"> Audio/video chat request type: "stream from recipient to requester".<br />The requester would like to receive the recipient's live a/v stream. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#sendChatRequest">sendChatRequest</a> </li></ul></div></div></div></div></div><div class="member" id="REQ_TYPE_SEND"><h3>REQ_TYPE_SEND</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">static</span> <b>REQ_TYPE_SEND</b>:String = <span class="codeString">"send"</span>
</div><div class="floatbox"><span class="access">(read)</span></div><br class="clear" /></div></div><div class="description"> 	Audio/video chat request type: "stream from requester to recipient".<br />The requester would like to send his own live a/v stream to the recipient. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#sendChatRequest">sendChatRequest</a> </li></ul></div></div></div></div></div><div class="member" id="REQ_TYPE_SEND_RECEIVE"><h3>REQ_TYPE_SEND_RECEIVE</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">static</span> <b>REQ_TYPE_SEND_RECEIVE</b>:String = <span class="codeString">"send&rcv"</span>
</div><div class="floatbox"><span class="access">(read)</span></div><br class="clear" /></div></div><div class="description"> Audio/video chat request type: "bi-directional stream".<br />The requester would like to establish a mutual live a/v connection. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#sendChatRequest">sendChatRequest</a> </li></ul></div></div></div></div></div></div><div class="memberSection"><h2 id="Instanceproperties">Instance properties</h2><div class="member" id="isConnected"><h3>isConnected</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><b>isConnected</b>:Boolean
</div><div class="floatbox"><span class="access">(read)</span></div><br class="clear" /></div></div><div class="description"> The status of the connection to the Red5 server.<br />If <code>true</code>, the connection to Red5 is currently available. </div></div></div><div class="memberSection"><h2 id="Instancemethods">Instance methods</h2><div class="member" id="acceptChatRequest"><h3>acceptChatRequest</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>acceptChatRequest</b> (
</div><div class="code">sessionId:String) : Void</div><br class="clear" /></div></div><div class="description"> 	Accept an incoming request to start an audio/video chat.<br />Calling this method causes the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStarted">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStarted</a> event to be fired on both the requester and the recipient clients. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">sessionId<span class="itemSeparator">:</span></div><div>the id of the chat session request to be accepted (see <a href="com_smartfoxserver_redbox_data_ChatSession.html#id">com.smartfoxserver.redbox.data.ChatSession.id</a> property).</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStarted">RedBoxChatEvent</a> with type: <code>onChatStarted</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat session is started, after the recipient accepted the requester's invitation.</li></ul></li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Throws:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_NoAVConnectionException.html">com.smartfoxserver.redbox.exceptions.NoAVConnectionException</a> if the connection to Red5 is not available. </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidChatSessionIdException.html">com.smartfoxserver.redbox.exceptions.InvalidChatSessionIdException</a> if the passed session id is unknown or the chat session is not in a <a href="com_smartfoxserver_redbox_data_ChatSession.html#STATUS_PENDING">com.smartfoxserver.redbox.data.ChatSession.STATUS_PENDING</a> status. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to accept a chat request.<br />			<pre>
bt_accept.addEventListener(<span class="codeString">"click"</span>, Delegate.create(<span class="codeIdentifier">this</span>, DleonAcceptBtClick))

<span class="codeComment">// After receiving a chat request, its session id is saved and an "accept" button activated...</span>

<span class="codeKeyword">function</span> onAcceptBtClick(evt:MouseEvent):<span class="codeIdentifier">Void</span>
{
    avChatMan.acceptChatRequest(chatSessionId)
}</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStarted">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStarted</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_NoAVConnectionException.html">com.smartfoxserver.redbox.exceptions.NoAVConnectionException</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidChatSessionIdException.html">com.smartfoxserver.redbox.exceptions.InvalidChatSessionIdException</a> </li></ul></div></div></div></div></div><div class="member" id="addEventListener"><h3>addEventListener</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>addEventListener</b> (

</div><div class="code">type:String,
listener:Function) : Void</div><br class="clear" /></div></div><div class="description"> 	Register a listener function in order to receive notification of a RedBox event.<br /><br />If you no longer need an event listener, remove it by calling the removeEventListener method.<br /><br /><b>NOTE</b>: use the Delegate.create() method when registering a listener, to keep right scope in your application. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">type    <span class="itemSeparator">:</span></div><div>The event type you want to be notified of.</div></div><div class="item"><div class="floatbox code colorizedCode">listener<span class="itemSeparator">:</span></div><div>The listener function in your application that processes the event. This function must accept an RedBoxChatEvent object as its only parameter and must return nothing, as in the example above. </div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Usage:</span><div class="item"><ul><li> To register to an event:<br />		<pre>
<span class="codeKeyword">import</span> com.smartfoxserver.redbox.events.*
<span class="codeKeyword">import</span> mx.utils.Delegate

avChatMan.addEventListener(RedBoxChatEvent.onChatRequest, Delegate.create(<span class="codeIdentifier">this</span>, myListener))

<span class="codeKeyword">private</span> <span class="codeKeyword">function</span> myListener(evt:RedBoxChatEvent):<span class="codeIdentifier">Void</span>
{
    <span class="codeIdentifier">trace</span>(<span class="codeString">"Got the event!"</span>)
    <span class="codeIdentifier">trace</span>(<span class="codeString">"Event type: "</span> + evt<span class="codeIdentifier">.type</span>)
    <span class="codeIdentifier">trace</span>(<span class="codeString">"Event target: "</span> + evt<span class="codeIdentifier">.target</span>)
    <span class="codeIdentifier">trace</span>(<span class="codeString">"Additional parameters:"</span>)

    <span class="codeKeyword">for</span> (<span class="codeKeyword">var</span> i <span class="codeKeyword">in</span> evt.params)
        <span class="codeIdentifier">trace</span>(<span class="codeString">"\t"</span> + i + <span class="codeString">" -&#62; "</span> + evt.params[i])
}</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#removeEventListener">removeEventListener</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html">com.smartfoxserver.redbox.events.RedBoxChatEvent</a> </li></ul></div></div></div></div></div><div class="member" id="destroy"><h3>destroy</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>destroy</b> (
</div><div class="code">) : Void</div><br class="clear" /></div></div><div class="description"> 	Destroy the AVChatManager instance.<br />Calling this method causes the interruption of all chat sessions currently in progress (if any) and the disconnection from Red5.<br />This method should always be called before deleting the AVChatManager instance. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to destroy the AVChatManager instance.<br />			<pre>
avChatMan.destroy()
avChatMan = <span class="codeIdentifier">null</span></pre> </li></ul></div></div></div></div></div><div class="member" id="getChatSession"><h3>getChatSession</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>getChatSession</b> (
</div><div class="code">sessionId:String) : <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">ChatSession</a></div><br class="clear" /></div></div><div class="description"> 	Retrieve a <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> object instance. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">sessionId<span class="itemSeparator">:</span></div><div>the id of the chat session to be retrieved (see <a href="com_smartfoxserver_redbox_data_ChatSession.html#id">com.smartfoxserver.redbox.data.ChatSession.id</a> property).</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Returns:</span><div class="item"><ul><li> The <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> object. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to get a chat session.<br />			<pre>
<span class="codeKeyword">var</span> chatData:ChatSession = avChatMan.getChatSession(sessionId)

<span class="codeKeyword">if</span> (chatData != <span class="codeIdentifier">null</span>)
    <span class="codeIdentifier">trace</span> (chatData<span class="codeIdentifier">.toString</span>())</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> </li></ul></div></div></div></div></div><div class="member" id="initAVConnection"><h3>initAVConnection</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>initAVConnection</b> (
</div><div class="code">) : Void</div><br class="clear" /></div></div><div class="description"> 	Initialize the audio/video connection.<br />Calling this method causes the connection to Red5 to be established and the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionInited">com.smartfoxserver.redbox.events.RedBoxChatEvent.onAVConnectionInited</a> event to be fired in response.<br />If the connection can't be established, the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionError">com.smartfoxserver.redbox.events.RedBoxChatEvent.onAVConnectionError</a> event is fired in response.<br /><b>NOTE</b>: this method is called automatically when the AVChatManager is instantiated. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Throws:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidParamsException.html">com.smartfoxserver.redbox.exceptions.InvalidParamsException</a> if the <code>red5IpAddress</code> is not well formated IP address. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionInited">RedBoxChatEvent</a> with type: <code>onAVConnectionInited</code> <ul class="summary inheritDoc"><li>	Dispatched when the connection to Red5 server has been established.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onAVConnectionError">RedBoxChatEvent</a> with type: <code>onAVConnectionError</code> <ul class="summary inheritDoc"><li>Dispatched when the connection to Red5 server can't be established.</li></ul></li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to initialize the Red5 connection for the AVChatManager instance.<br />			<pre>
avChatMan.initAVConnection()</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#isConnected">isConnected</a> </li><li> <a href="com_smartfoxserver_redbox_events_RedBoxClipEvent.html#onAVConnectionInited">com.smartfoxserver.redbox.events.RedBoxClipEvent.onAVConnectionInited</a> </li><li> <a href="com_smartfoxserver_redbox_events_RedBoxClipEvent.html#onAVConnectionError">com.smartfoxserver.redbox.events.RedBoxClipEvent.onAVConnectionError</a> </li></ul></div></div></div></div></div><div class="member" id="refuseChatRequest"><h3>refuseChatRequest</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>refuseChatRequest</b> (
</div><div class="code">sessionId:String) : Void</div><br class="clear" /></div></div><div class="description"> 	Refuse an incoming request to start an audio/video chat.<br />Calling this method causes the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRefused">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRefused</a> event to be fired on the requester's client. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">sessionId<span class="itemSeparator">:</span></div><div>the id of the chat session request to be refused (see <a href="com_smartfoxserver_redbox_data_ChatSession.html#id">com.smartfoxserver.redbox.data.ChatSession.id</a> property).</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRefused">RedBoxChatEvent</a> with type: <code>onChatRefused</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat request has been refused by the recipient.</li></ul></li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Throws:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidChatSessionIdException.html">com.smartfoxserver.redbox.exceptions.InvalidChatSessionIdException</a> if the passed session id is unknown or the chat session is not in a <a href="com_smartfoxserver_redbox_data_ChatSession.html#STATUS_PENDING">com.smartfoxserver.redbox.data.ChatSession.STATUS_PENDING</a> status. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to refuse a chat request.<br />			<pre>
bt_decline.addEventListener(<span class="codeString">"click"</span>, Delegate.create(<span class="codeIdentifier">this</span>, onDeclineBtClick))

<span class="codeComment">// After receiving a chat request, its session id is saved and a "decline" button activated...</span>

<span class="codeKeyword">function</span> onDeclineBtClick(evt:MouseEvent):<span class="codeIdentifier">Void</span>
{
    avChatMan.refuseChatRequest(chatSessionId)
}</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRefused">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRefused</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidChatSessionIdException.html">com.smartfoxserver.redbox.exceptions.InvalidChatSessionIdException</a> </li></ul></div></div></div></div></div><div class="member" id="removeEventListener"><h3>removeEventListener</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>removeEventListener</b> (

</div><div class="code">type:String,
listener:Function) : Void</div><br class="clear" /></div></div><div class="description"> 	Remove a listener from the event dispatcher, to stop receiving notification of an event.  </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">type    <span class="itemSeparator">:</span></div><div>The event type you registered your listener to.</div></div><div class="item"><div class="floatbox code colorizedCode">listener<span class="itemSeparator">:</span></div><div>The listener function to remove.</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Usage:</span><div class="item"><ul><li> To remove a listener:<br />		<pre>
avChatMan.removeEventListener(RedBoxChatEvent.onChatRequest, myListener)</pre>		<b>NOTE</b>: the Delegate.create() is not required to remove a listener. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_AVChatManager.html#addEventListener">addEventListener</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html">com.smartfoxserver.redbox.events.RedBoxChatEvent</a> </li></ul></div></div></div></div></div><div class="member" id="sendChatRequest"><h3>sendChatRequest</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>sendChatRequest</b> (



</div><div class="code">type:String,
recipientId:Number,
enableCamera:Boolean,
enableMicrophone:Boolean) : <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">ChatSession</a></div><br class="clear" /></div></div><div class="description"> 	Send a request to start an audio/video chat.<br />When this method is called, a "chat session" is created (see the <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> class description) and an invitation to start the a/v chat is sent to the selected user id, causing the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRequest">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRequest</a> event to be fired on the recipient's client.<br />If the recipient is not available (for example he disconnects while the request is being sent), the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onRecipientMissing">com.smartfoxserver.redbox.events.RedBoxChatEvent.onRecipientMissing</a> event is fired in response.<br />If the mutual request has already been sent by the recipient, the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onDuplicateRequest">com.smartfoxserver.redbox.events.RedBoxChatEvent.onDuplicateRequest</a> is fired in response.<br />Audio and video recording mode/quality should be set before calling this method. In order to alter these settings, please refer to the Microphone and Camera classes documentation. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">type            <span class="itemSeparator">:</span></div><div>the request type; valid values are: <a href="com_smartfoxserver_redbox_AVChatManager.html#REQ_TYPE_SEND">REQ_TYPE_SEND</a>, <a href="com_smartfoxserver_redbox_AVChatManager.html#REQ_TYPE_RECEIVE">REQ_TYPE_RECEIVE</a> and <a href="com_smartfoxserver_redbox_AVChatManager.html#REQ_TYPE_SEND_RECEIVE">REQ_TYPE_SEND_RECEIVE</a>.</div></div><div class="item"><div class="floatbox code colorizedCode">recipientId     <span class="itemSeparator">:</span></div><div>the SmartFoxServer's user id of the recipient.</div></div><div class="item"><div class="floatbox code colorizedCode">enableCamera    <span class="itemSeparator">:</span></div><div>enable video live streaming; default value is <code>true</code>.</div></div><div class="item"><div class="floatbox code colorizedCode">enableMicrophone<span class="itemSeparator">:</span></div><div>enable audio live streaming; default value is <code>true</code>.</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Returns:</span><div class="item"><ul><li> The <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> object created, or <code>null</code> if the same request type has already been sent to the same recipient (and it's still pending or already accepted). </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRequest">RedBoxChatEvent</a> with type: <code>onChatRequest</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat request is received.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onRecipientMissing">RedBoxChatEvent</a> with type: <code>onRecipientMissing</code> <ul class="summary inheritDoc"><li>Dispatched when a chat request is sent, but the recipient is not available.</li></ul></li><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onDuplicateRequest">RedBoxChatEvent</a> with type: <code>onDuplicateRequest</code> <ul class="summary inheritDoc"><li>Dispatched when a chat request is sent, but a mutual request has already been sent by the recipient.</li></ul></li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Throws:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_NoAVConnectionException.html">com.smartfoxserver.redbox.exceptions.NoAVConnectionException</a> if the connection to Red5 is not available. </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidParamsException.html">com.smartfoxserver.redbox.exceptions.InvalidParamsException</a> if both <i>enableCamera</i> and <i>enableMicrophone</i> parameters are set to <code>false</code>. </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_BadRequestException.html">com.smartfoxserver.redbox.exceptions.BadRequestException</a> if the wrong request type is passed when calling this method. </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to send a request to start an a/v chat.<br />			<pre>
avChatMan.addEventListener(RedBoxChatEvent.onRecipientMissing, Delegate.create(<span class="codeIdentifier">this</span>, onRecipientMissing))
avChatMan.addEventListener(RedBoxChatEvent.onDuplicateRequest, Delegate.create(<span class="codeIdentifier">this</span>, onDuplicateRequest))

avChatMan.sendChatRequest(AVChatManager.REQ_TYPE_SEND_RECEIVE, buddyId, <span class="codeIdentifier">true</span>, <span class="codeIdentifier">true</span>)

<span class="codeKeyword">function</span> onRecipientMissing(evt:RedBoxChatEvent):<span class="codeIdentifier">Void</span>
{
    <span class="codeIdentifier">trace</span> (<span class="codeString">"Request '</span><span class="codeString">" + evt.params.chatSession.id + "</span><span class="codeString">' error: the recipient is not available!"</span>)
}

<span class="codeKeyword">function</span> onDuplicateRequest(evt:RedBoxChatEvent):<span class="codeIdentifier">Void</span>
{
    <span class="codeIdentifier">trace</span> (<span class="codeString">"Request '</span><span class="codeString">" + evt.params.chatSession.id + "</span><span class="codeString">' error: a mutual request has already been sent by the recipient!"</span>)
}</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> </li><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatRequest">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatRequest</a> </li><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onRecipientMissing">com.smartfoxserver.redbox.events.RedBoxChatEvent.onRecipientMissing</a> </li><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onDuplicateRequest">com.smartfoxserver.redbox.events.RedBoxChatEvent.onDuplicateRequest</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_NoAVConnectionException.html">com.smartfoxserver.redbox.exceptions.NoAVConnectionException</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_InvalidParamsException.html">com.smartfoxserver.redbox.exceptions.InvalidParamsException</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_exceptions_BadRequestException.html">com.smartfoxserver.redbox.exceptions.BadRequestException</a> </li><li> <span class="doesNotExist"> Camera</span> </li><li> <span class="doesNotExist"> Microphone</span> </li></ul></div></div></div></div></div><div class="member" id="stopChat"><h3>stopChat</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code">function <b>stopChat</b> (
</div><div class="code">sessionId:String) : Void</div><br class="clear" /></div></div><div class="description"> 	Stop an a/v chat session currently in progress.<br />Calling this method causes the <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStopped">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStopped</a> event to be fired on the connected user (mate) clients. </div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Parameters:</span><div class="item"><div class="floatbox code colorizedCode">sessionId<span class="itemSeparator">:</span></div><div>the id of the chat session to be stopped (see <a href="com_smartfoxserver_redbox_data_ChatSession.html#id">com.smartfoxserver.redbox.data.ChatSession.id</a> property).</div></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Events broadcasted to listeners:</span><div class="item"><ul><li><a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStopped">RedBoxChatEvent</a> with type: <code>onChatStopped</code> <ul class="summary inheritDoc"><li>Dispatched when an a/v chat session is stopped.</li></ul></li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">Example:</span><div class="item"><ul><li> The following example shows how to stop a chat session.<br />			<pre>
bt_stop.addEventListener(<span class="codeString">"click"</span>, Delegate.create(<span class="codeIdentifier">this</span>, onStopBtClick))

<span class="codeComment">// After the chat session started, a "stop" button is activated...</span>

<span class="codeKeyword">function</span> onStopBtClick(evt:MouseEvent):<span class="codeIdentifier">Void</span>
{
    avChatMan.stopChat(chatSessionId)
}</pre> </li></ul></div></div></div><div class="boxedElem"><div class="contentHolder"><span class="title">See also:</span><div class="item"><ul><li> <a href="com_smartfoxserver_redbox_events_RedBoxChatEvent.html#onChatStopped">com.smartfoxserver.redbox.events.RedBoxChatEvent.onChatStopped</a> </li><li> <a class="className" href="com_smartfoxserver_redbox_data_ChatSession.html">com.smartfoxserver.redbox.data.ChatSession</a> </li></ul></div></div></div></div></div></div><div class="footer"><ul class="docFooter"><li class="copyright">&copy; gotoAndPlay() - 2008</li></ul></div></div></div></body></html>